services:
  moltbot-gateway:
    image: ghcr.io/moltbot/moltbot:latest
    container_name: moltbot-gateway
    restart: unless-stopped
    ports:
      - "18789:18789"
      - "18790:18790"
    environment:
      - HOME=/home/node
      - NODE_ENV=production
      - CLAWDBOT_GATEWAY_BIND=0.0.0.0
      - CLAWDBOT_GATEWAY_TOKEN=${CLAWDBOT_GATEWAY_TOKEN}
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
    volumes:
      - moltbot-config:/home/node/.clawdbot
      - moltbot-workspace:/home/node/clawd
      - moltbot-home:/home/node
    networks:
      - moltbot-network
    healthcheck:
      test: ["CMD", "node", "dist/index.js", "health", "--token", "${CLAWDBOT_GATEWAY_TOKEN}"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s
    command: ["node", "dist/index.js", "gateway"]

  moltbot-cli:
    image: ghcr.io/moltbot/moltbot:latest
    container_name: moltbot-cli
    profiles:
      - cli
    stdin_open: true
    tty: true
    environment:
      - HOME=/home/node
      - CLAWDBOT_GATEWAY_TOKEN=${CLAWDBOT_GATEWAY_TOKEN}
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
    volumes:
      - moltbot-config:/home/node/.clawdbot
      - moltbot-workspace:/home/node/clawd
      - moltbot-home:/home/node
    networks:
      - moltbot-network
    entrypoint: ["node", "dist/index.js"]

volumes:
  moltbot-config:
    name: moltbot-config
  moltbot-workspace:
    name: moltbot-workspace
  moltbot-home:
    name: moltbot-home

networks:
  moltbot-network:
    driver: bridge
    name: moltbot-network
